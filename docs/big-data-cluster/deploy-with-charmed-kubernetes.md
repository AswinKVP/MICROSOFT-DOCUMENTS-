---
title: Deploy on Charmed Kubernetes
titleSuffix: SQL Server Big Data Clusters
description: How to deploy Microsoft Big Data Clusters on Charmed Kubernetes
author: evilnick
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
---

# Deploy [!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] on Charmed Kubernetes

[!INCLUDE[SQL Server 2019](../includes/applies-to-version/sqlserver2019.md)]

This article explains how to deploy a SQL Server Big Data Cluster (BDC) on [Charmed Kubernetes][]. 

> [!TIP]
> text text text.


text text text text text text xxxxx xxxx xx x xx x xxxx.

## Pre-requisites

-   **[Juju][]**: Juju is a tool which provides full automation of software deployments and operations. **Charmed Kubernetes** uses Juju to deploy, configure and operate the applications which combine to make a running Kubernetes cluster. Juju is available for Ubuntu, Windows 10, macOS and various Linux variants.
    -   Ubuntu 18.04+: Run the command: `sudo snap install juju --classic`
    -   Windows 10: Download and run the installer [here][juju-win].
    -   For macOS and non-Ubuntu Linux systems, see the [install documentation][juju-install-docs].      
-   The `azdata` command line tool to bootstrap and manage the big data cluster. See the separate [install documentation here][azdata-install].
-   The `kubectl` command line tool, to access thye Kubernetes cluster.
-   An SSH keypair: Juju expects an SSH keypair for secure communication between the client and any units deployed. Almost all Linux distributions automatically generate SSH keys when installed. Windows 10 and Windows Server both now include the [OpenSSH][] software used to manage and use SSH keys, but a key must be generated by running the command `ssh-keygen` (more details [here][ssh-keygen]).
-   Cloud Credentials: Juju can operate and manage applications on a variety of hardware as well as major public clouds including Azure, AWS, Google, OpenStack, VMWare. To access these clouds it will be necessary to supply Juju with the appropriate credentials. This can be as simple as running the command:
`juju add-credential azure` 
and following the interactive prompt. For the purposes of this document we will assume an Azure public cloud, noting where there may be differences. For more details on credentials and using Juju with different clouds, see the [Juju documentation][juju-docs-credentials].
  

## Deploy Charmed Kubernetes


bootstrap

```bash
juju bootstrap azure/ukwest azk8s
```

add model 

```bash
juju add-model ckbdc
```

There are two charm bundles associated with Charmed Kubernetes, these are:
-   `charmed-kubernetes`
-   `kubernetes-core`

Both represent a complete install of a Kubernetes cluster, but while the first is intended as the basis of a full production cluster with the various components running on their own machines and with multiple master and worker units, the second is a minimalist version which requires just two machines and co-locates many applications on one of them. This bundle is more suitable as the basis for testing and more customised deployments. Either version can be used to run the SQL BDC, but as it has some specific requirements the `kubernetes-core` bundle is easier to adapt and is more economical.

The system requirements of the SQL BDC specify the node it is run on should have:
-   8 vCPUs
-   64GB RAM
-   100GB storage

An 'overlay' file can be created for the `kubernetes-core` bundle to request that the kubernetes-worker machine has at least these requirements. An overlay is simply an additional YAML file which is merged on top of the bundle before it is deployed.

The full kubernetes-core bundle YAMl can be viewd [here][kubernetes-core-bundle].

In addition to the machine specs, it is also necessary to modify the configuration for the `kubernetes-master` charm to allow the `kube-api-server` to run in privilleged mode. The changes can be expressed in the following overlay:

```yaml
machines:
  '0':
    constraints: cores=2 mem=4G root-disk=16G
    series: bionic
  '1':
    constraints: cores=8 mem=64G root-disk=100G
    series: bionic
applications:
  kubernetes-master:
    options:
      channel: 1.18/stable
      allow-privileged: 'True'
  kubernetes-worker:
    constraints: cores=8 mem=64G root-disk=100G
```


download overlay

create additional overlay
  worker constraints

  The minimum requirements for a node running BDC are given as  (8 vCPUs, 64 GB of memory, 100G of disk space). 
 
  privileged mode

deploy ck

As part of the deployment, the kubernetes master unit will generate a config file. This config is used by the `kubectl` tool to manage the cluster. We can fetch it from the Kubernetes master unit to a local machine with:

```bash
 juju scp kubernetes-master/leader:config ~/.kube/config
```


persistent storage


Install BDC tools


<!--LINKS-->
[Charmed Kubernetes]: https://ubuntu.com/kubernetes/docs/overview
[Juju]: https://juju.is
[ssh-keygen]: https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_overview
[OpenSSH]: https://www.openssh.com/
[juju-win]: https://juju.is/docs/installing#heading--windows
[juju-install-docs]: https://juju.is/docs/installing
[juju-docs-credentials]: https://juju.is/docs/credentials
[azdata-install]: https://docs.microsoft.com/en-us/sql/big-data-cluster/deploy-install-azdata?view=sql-server-ver15
[kubernetes-core-bundle]